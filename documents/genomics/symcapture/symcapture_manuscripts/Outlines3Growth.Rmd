---
title: "Like mother, like daughter: forest gap dynamics drives divergent adaptive growth strategies within tropical tree species"
date: '`r Sys.Date()`'
output: 
  bookdown::html_document2:
    number_sections: false  
    toc: true
    toc_float: yes
  bookdown::pdf_document2:
    includes:
      before_body: ./template/doc_prefix.tex
      in_header: ./template/preamble.tex
    number_sections: false
    toc: false
  bookdown::word_document2:
    reference_docx: ./template/template.docx
linestretch: 1.5
csl: /home/sylvain/Documents/Bibliography/csl/mee.csl
bibliography: /home/sylvain/Documents/Bibliography/library.bib
link-citations: yes
---

**Forest gap dynamics have a strong impact on tree ecology, triggering a wide variety of demographic responses depending on functional strategies of individuals and species. Traditionally, demographic responses to forest gap dynamics have been studied between species, neglecting genetic variability within species. However, overlapping generations can maintain the genetic variation necessary for strong temporally variable selection to act on specific life stages. Here we provide evidence that mature-forest species can grow in a diversity of successional niches thanks to genotypic adaptations to fine spatio-temporal dynamics of forest gaps, which decreases the overall risk of a stochastic local extinction.**

The heterogeneity of resource distribution in space and time defines fine-scale habitat structure where species and individuals can grow and coexist [@Lortie2004a; @weiher_assembly_1995]. 
For instance, topography drives the spatial distribution of water and nutrient availability in tropical forests [@Ferry2010]. 
Therefore, topography drives pervasive differentiation in habitat preference among species [@Allie2015; Schmitt et al., in prep] and in functional responses among and within species [@Schmitt2020]. 
In natural tropical forests, competition for light due to forest gap dynamics [@Hubbell1999; @Molino2001] is often greater than the effect of competition for water and nutrients, even in early successional stages [@VanBreugel2012].
Forest gap dynamics is characterised by successional niches that trigger a wide variety of demographic responses depending on functional strategies of individuals and species[@Herault2010; @Ruger2009]. 
After a treefall, pioneer species with fast growth, thanks to productive leaf tissue and light wood, rapidly colonize gaps with high light availability and decreased competition from adult trees; then, late successional species with slow growth and more conservative tissue progressively establish in a more shaded environment with increased competition [@Craven2015].

But “nothing in biology makes sense except in the light of evolution” [@Dobzhansky1973].
Topography and abiotic habitats have been shown to drive differential adaptation of species, in the case of adaptive radiations [@Paun2016; @Pillon2014], and within species, with microgeographic adaptations within the dispersal neighbourhood of the organism [@Brousseau2015; @Richardson2014; @Team2013]. 
However, despite the strong impact of forest gap dynamics on tree ecology [@VanBreugel2012], to our knowledge, no studies have explored the possible role of forest gap dynamics on adaptation within species.

The assumption that evolution and ecology play at very different times and spatial scales might have been an impediment to understanding the role of forest gap dynamics in the eco-evolutionary dynamics of species [@Pelletier2009]. 
Overlapping generations can maintain the genetic variation necessary for strong temporally variable selection to act on a specific life stage [@Ellner1994]. The storage [@Chesson1983] of genotypes in long-lived stages, on which the fluctuating selection does not act, maintains genetic diversity. 
Nevertheless, genetic variation is maintained only if mixed-strategy bet hedging, i.e., dual evolutionary strategies within individuals, is prevented by physiological or adaptation constraints. 
For instance, overlapping generations with oscillation between short high-recruitment periods and long population-decline periods explain the spatial genetic structure of the Neotropical tree Jacaranda copaia [@Jones2006].

The dynamics of forest gaps strongly determines the survival and recruitment of young tropical trees through competition for access to light; whereas once in the canopy, adult trees are less vulnerable to successional niches. Adult trees can therefore act as a reservoir of genotypes against fine spatio-temporal dynamics of forest gaps. 
Generations of tropical trees broadly overlap, for instance mature-forest tree species with a maturity starting around 20cm grow up to 1m of diameter at breast height [@Hardy2006].
Tropical trees thus disperse many seedlings over time into a mosaic of light conditions that fluctuates spatially and temporally due to the dynamics of forest gaps. 
Individual offspring encounter mainly shady and sometimes bright environments in which they must grow to survive. 
Since the dynamics of forest gaps opposes rapid growth in a bright environment to slow growth in a shaded environment, we expected that individual genotypes within typical mature-forest species would be adapted to a trade-off between ability for fast growth and ability to persist in shade. 
Consequently, we hypothesized forest gap dynamics to be a major driver of the structuring of genotypic diversity within tropical tree species.

Following our hypothesis, we expected that the genotypic trade-off would be spatially structured in the area where a tree falls. 
Finally, we expected the genotypic trade-off to be structured in time. 
Because of recent selection, genotypic adaptations to growth in different light conditions are expected to be more pronounced in the intermediate stage. Younger stages may be mostly affected by  very stochastic survival. 
Conversely, older stages should be less vulnerable to forest gap dynamics.

In the present study, we assessed genotypic diversity within closely-related sympatric tree species belonging to the widespread tropical tree species complex Symphonia globulifera.
We addressed the fine-scale spatial and temporal genetic adaptations of individuals through differential growth strategies in response to forest gap dynamics. 
Combining tree growth data, measures of light environment and single nucleotide polymorphisms (SNPs), we used population genomics, environmental association analyses, genome wide association studies and growth modelling to address the following questions:

* Are individual genotypes structured by the neighbourhood crowding gradient resulting from forest gap dynamics?
* Is the growth of individuals determined by genotypes?
* Can we identify a trade-off between genotypic adaptations to neighbourhood crowding and growth?
* How are genotypic adaptations to neighbourhood crowding and growth structured in space and time?

*Quick methods*

We sampled leaf tissue from 402 individuals previously morphologically identified as *Symphonia globulifera* and *Symphonia sp. 1* in the Paracou field station, where individuals have been censused for more than 30 years. 
We designed and conducted a targeted sequence capture experiment of genomic regions obtaining sequence information for each individual. 
We called, filtered and annotated single nucleotide polymorphisms (SNPs) of sequenced libraries against the references used to build the experiment. 
We analyzed population genetic structure, genetic diversity, and demographic history. 
We then measured association of species and genotypes to mean neighbourhood crowding and individual growth potential over the last 30 years with Bayesian inferences of animal and growth models. 
Finally, we investigated the relationships between genotypic associations to neighbourhood crowding and individual growth and their structure in space and time with respectively spatial autocorrelogram and decomposed relations over diameter classes.

*Main results*

*Symphonia globulifera* was locally composed of three sympatric species corresponding to three morphotypes with differentiated topographic niches (Schmitt et al., in prep). 
Individual genotypes explained a significant variation in individual according crowding (NCI, $R_m^2−R_c^2=0.18$) and individual growth potential (Gmax, $R_m^2−R_c^2=0.43$, Fig. \@ref(fig:VarPart)), indicating an adaptive response of Symphonia genotypes according to these variables. 
Spatially, genotypic adaptation to neighbourhood crowding ($gNCI$) and individual growth potential ($gGmax$) were structured up to 47m ($Moran’s~I, p−value<0.01$, Fig. \@ref(fig:SpCor)).
Moreover, a negative significant correlation (Pearson's $R=−0.3$, $p=4.5.10^{−9}$) was observed between genotypic values for neighbourhood crowding ($NCI$) those for individual growth potential ($Gmax$) across diameter classes (Fig. \@ref(fig:gCor)), with a stronger signal for intermediate diameter classes than small or large individuals.
Consequently, individual genotypes within *Symphonia* species were adapted to a tradeoff between neighbour crowding tolerance and individual growth potential structured spatially and across diameter classes.

*Quick discussion*

Following our hypothesis, we found that individual tree genotypes are differentially adapted to regenerate and thrive in response to the fine spatio-temporal dynamics of forest gaps.
A genetic trade-off exists between intra-specific adaptive strategies for competition vs. for growth. 
The genetic trade-off is spatially structured in the area where a tree falls.
The genetic trade-off is also temporally structured with a stronger effect in the intermediate stages, than in young stages under diverse selection pressures or in immune older stages. 
Therefore, a species uses differentiated growth strategies that allow its individuals to grow in a diversity of successional niches, thanks to these genotypic adaptations to forest gap dynamics, decreasing overall the risk of a stochastic local extinction.
Consequently, the effect of forest gap dynamics on genetic adaptations among tropical tree species [@Herault2010; @Ruger2009] is conserved within species in the species complex Symphonia globulifera. 
Our results observed in a complex containing three species question the influence of forest gap dynamics on genotypes in species complexes and more generally widespread species of tropical forest trees.

# Figures

```{r config, message=FALSE, warning=FALSE, include=FALSE}
rm(list = ls()); invisible(gc())
library(knitr)
library(tidyverse)
library(bayesplot)
theme_set(bayesplot::theme_default())
opts_chunk$set(echo = F, message = F, warning = F, 
               fig.height = 4, fig.width = 6,
               cache = T, cache.lazy = F)
load(file = "../symcapture_save/outlines.Rdata")
```

```{r VarPart, fig.cap="Variance partitioning for neighbor crowding index (NCI) and individual maximum growth potential (Gmax). Variation of each variable has been partitioned into between-species (red), between-genotype (green), and residual (blue) variation."}
lapply(list(NCI = fitNCI, Gmax = fitGmaxGeno), 
       mcmc_intervals_data, regex_pars = c("Vp", "Vg", "Vr")) %>% 
  bind_rows(.id = "variable") %>% 
  mutate(parameter = recode(parameter, "Vp" = "Species", 
                            "Vg" = "Genotype", "Vr" = "Residual")) %>%
  mutate(variable = factor(variable, levels = c("NCI", "Gmax"))) %>% 
  group_by(variable) %>% 
  mutate(pct = paste0(round(m / sum(m) * 100), "%")) %>% 
  ggplot(aes(x = variable, fill = parameter)) +
  geom_col(aes(y = m)) +
  geom_text(aes(y = m, label = pct), col = "white", position = position_stack(vjust = .5)) +
  facet_wrap(~ variable, scales = "free") +
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(),
        axis.text.x = element_blank(), axis.line.x = element_blank(), axis.ticks.x = element_blank(),
        legend.position = "bottom") +
  scale_fill_discrete(expression(sigma^2)) 
```

```{r SpCor, fig.cap="Spatial autocorrelogram for raw variable and genotypic values of neighbor crowding index (NCI) and individual maximum growth potential (Gmax). The spatial autoccorelogram shows Moran's I value for different distance classes with significant values represented by a filled points against transparent non-significant values. Lines and points colors represent neighbor crowding index (blue) and individual maximum growth potential (red). Linetype represents raw variable (dashed) and genotypic values (continuous)."}
cor %>% 
  filter(dist.class < 10^3) %>% 
  filter(variable %in% c("Gmax", "NCI", "gGmax", "gNCI")) %>% 
  mutate(type = ifelse(substr(variable, 1, 1) == "g", "genotype", "variable")) %>% 
  mutate(variable = gsub("^g", "", variable)) %>% 
  ggplot(aes(x = dist.class, y = coef, col = variable, linetype = type)) + 
  geom_hline(yintercept = 0) +
  geom_point(aes(alpha = p.value < 0.01)) + 
  geom_line() +
  scale_alpha_manual(guide = "none", values = c(0.3, 1)) + 
  scale_linetype("") +
  scale_color_discrete("") +
  scale_x_log10() +
  geom_vline(xintercept = c(27, 53), col = "lightgrey", linetype = "dashed") +
  geom_vline(xintercept = 150, col = "lightgrey", linetype = "dotted") +
  xlab("Distance (m)") + ylab("Moran\'s I") +
  theme(legend.position = "bottom")
```

```{r gCor, fig.cap="Relation between geontypic values for individual growth potential (Gmax) and neighbor wroding index (NCI) for different class of diameters. Regression lines represent a linear model of form y ~ x. Annotations gives for each diameter class the Pearson's R correlation coefficient and the associated p-value.", fig.width=8}
n <- 6
t %>% 
  arrange(DBHtoday) %>% 
  mutate(DBHclass = rep(1:n, each = ceiling(nrow(.)/n))[1:nrow(.)]) %>% 
  group_by(DBHclass) %>% 
  mutate(DBHclassCm = paste0(round(min(DBHtoday)), " - ", round(max(DBHtoday)), " cm")) %>% 
  ggplot(aes(aGmax, aNCI)) +
  geom_point(alpha = 0.5) +
  facet_wrap(~ DBHclassCm, scales = "free") +
  geom_smooth(method = "lm", col = "black") +
  scale_size_continuous(guide = "none") +
  ggpubr::stat_cor(method = "pearson", label.x = 0.5, label.y = 0.85, ) +
  xlab("Genotypic value for individual growth potential (Gmax)") +
  ylab("Genotypic value for neighbor crowding index (NCI)")
```

# References

